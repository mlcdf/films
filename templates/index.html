{% import "macros.html" as macros %}

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
    <title>{% block title %}{{ config.title }} &mdash; {{ config.extra.author}}{% endblock title %}</title>
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"/>
    <link rel="stylesheet" href="{{ get_url(path="style.css", trailing_slash=false) }}">
</head>
<body class="bg-washed-red near-black relative h-100 pa0">
    {% block header %}
    <header class="pb4 flex justify-between pt3 ph3">
        <div>
            <a class="dib near-black link" href="/"><h1 class="db f5 ma0 ba b--dashed bw1 pa2 dim">films.mlcdf.fr</h1></a>
            <a href="/info" class="ml3 dib">Info</a>
            <label class="db pointer"><input class="mt3 js-show-french-title" type="checkbox" checked> Titres en üá´üá∑</label>
        </div>
        <nav class="db">
            {% set all = get_section(path="_index.md") %}
            <a href="{{ all.permalink }}" class="dib pa2 ba br-50 link bw1 near-black dim">{{ all.title }}</a>

            {% set cinema = get_section(path="cinema/_index.md") %}
            <a href="{{ cinema.permalink }}" class="dib pa2 ba br-50 link bw1 near-black dim">{{ cinema.title }}</a>

            {% set top10 = get_section(path="10/_index.md") %}
            <a href="{{ top10.permalink }}" class="dib pa2 ba br-50 link bw1 near-black dim">{{ top10.title }}</a>
        </nav>
    </header>
    {% endblock header %}

    <main class="ph3">
        {% block content %}

        {% set data = load_data(url="https://raw.githubusercontent.com/mlcdf/films/backup/mlcdf/films-done.json", format="json") %}

        <div class="pb5 mb3 flex w-100 justify-center">
            <div class="bt pt3 mr4 bw1 measure-narrow w-100 lh-copy">
                <div class="f-subheadline fw6 mb1 lh-solid">{{ data.entries | length }}</div>
                <p class="mt0 fw6">Films vus</p>
            </div>
            <div class="bt pt3 ml4 bw1 measure-narrow w-100 lh-copy">
                {% set x = data.entries | map(attribute="authors") %}

                {% set_global authors = [] %}
                {% for _authors in x %}
                    {% set_global authors = authors | concat(with=_authors) %}
                {% endfor %}

                <div class="f-subheadline fw6 mb1 lh-solid">{{ authors | unique | length }}</div>
                <p class="mt0 fw6">R√©alisateur/trices diff√©rents</p>
            </div>
        </div>

        <table cellspacing="0" class="w-100">
            <thead>
                <th class="pb3 pr3">Titre</th>
                <th class="pb3 pr3">Ann√©e</th>
            <th class="pb3 pr3">R√©alisateur/trice(s)</th>
            <th class="pb3 pr3">Appr√©ciation</th>
                <th class="pb3 pr3"></th>
            </thead>
            <tbody>
            {% for movie in data.entries | sort(attribute="title") %}
                <tr>
                    <td class="pv3 pr3 bt b--black-10 f4">{{ macros::title(movie=movie) }}</td>
                    <td class="pv3 pr5 bt b--black-10 f4">{{ movie.year | default(value="??") }}</td>
                    <td class="pv3 pr3 bt b--black-10 f4">{{ movie.authors | join(sep=", ") }}</td>
                    <td class="pv3 pr3 bt b--black-10 f4">
                        {% if movie.rating is defined %}
                            {{ macros::rating(rating=movie.rating) }}
                        {% else %}
                            ü§∑‚Äç‚ôÇÔ∏è
                        {% endif %}
                    </td>
                    {% set x = movie.comment | default(value="") | split(pat=" ") %}
                    <td class="pv3 pr3 bt b--black-10 f4">
                        {% if x[0] | trim != "" %}
                            <div class="dib ph2 br2 ba b--dark-red dark-red">{{ x[0] | trim }}</div>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endblock content %}
    </main>
    <script>
        const showFrenchTitle = document.querySelector(".js-show-french-title");

        showFrenchTitle.addEventListener("click", function(event) {

            if (showFrenchTitle.checked) {
                showOriginalTitle();
            } else {
                showTitle();
            }

            function showOriginalTitle() {
                document.querySelectorAll(".js-original-title").forEach(function(el) {
                    el.style.display = "none"
                });

                document.querySelectorAll(".js-title").forEach(function(el) {
                    el.style.display = "inline"
                });
            }

            function showTitle() {
                document.querySelectorAll(".js-original-title").forEach(function(el) {
                    el.style.display = "inline"
                });

                document.querySelectorAll(".js-title").forEach(function(el) {
                    el.style.display = "none"
                });
            }
        })

    </script>

</body>
</html>
